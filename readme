# Proyecto CINF104 - ClasificaciÃ³n de GRD en Pacientes Hospital El Pino ğŸ¥

Este repositorio corresponde al desarrollo del **Proyecto 1** de la asignatura *Aprendizaje de MÃ¡quinas (CINF104)*. El objetivo principal es predecir el grupo relacionado de diagnÃ³stico (**GRD**) de un paciente en base a su informaciÃ³n clÃ­nica, utilizando distintos modelos de clasificaciÃ³n.

---

## ğŸ§± Arquitectura del Proyecto

ğŸ“‚ raÃ­z_del_proyecto/  
â”‚  
â”œâ”€â”€ ğŸ“‚ data/                          # Datos originales del hospital  
â”‚   â”œâ”€â”€ CIE-9.xlsx                   # CÃ³digos de procedimientos mÃ©dicos  
â”‚   â”œâ”€â”€ CIE-10.xlsx                  # CÃ³digos de diagnÃ³sticos mÃ©dicos  
â”‚   â”œâ”€â”€ dataset_elpino.csv          # Dataset clÃ­nico principal  
â”‚   â””â”€â”€ Tablas maestras bases GRD.xlsx  # Tabla de referencia para GRDs  
â”‚  
â”œâ”€â”€ ğŸ“‚ modelos/                      # Modelos entrenados en formato .pkl  
â”œâ”€â”€ ğŸ“‚ imagenes/                     # Matrices de confusiÃ³n generadas por los modelos  
â”œâ”€â”€ ğŸ“‚ resultados/                   # Resultados de predicciones y comparaciones  
â”‚  
â”œâ”€â”€ ğŸ codigo.py                     # Script de preprocesamiento completo  
â”‚                                   # - Limpieza, codificaciÃ³n, balanceo  
â”‚                                   # - Exporta nuevo_dataset  
â”‚  
â”œâ”€â”€ ğŸ graficos.py                   # ExploraciÃ³n visual del dataset  
â”‚                                   # - GrÃ¡ficos de distribuciÃ³n, correlaciÃ³n, boxplots, etc.  
â”‚  
â”œâ”€â”€ ğŸ modelos_prueba.py             # Entrena 4 modelos (RF, DT, XGB, MLP)  
â”‚                                   # - Calcula mÃ©tricas y genera matrices de confusiÃ³n  
â”‚  
â”œâ”€â”€ ğŸ entrenar_xgboost.py           # Entrena especÃ­ficamente un modelo XGBoost  
â”‚                                   # - Guarda el modelo y el codificador  
â”‚  
â”œâ”€â”€ ğŸ prueba_xgboost.py             # EvalÃºa el modelo XGBoost entrenado  
â”‚                                   # - Muestra mÃ©tricas y predicciones generales  
â”‚  
â”œâ”€â”€ ğŸ xgboost_decode.py             # Realiza predicciones individuales con decodificaciÃ³n  
â”‚                                   # - Muestra el GRD real, predicho, descripciones y si coincide  
â”‚  
â”‚                                    
â”œâ”€â”€ ğŸ“„ readme                        # Este archivo  
â”œâ”€â”€ ğŸ“„ requirements.txt              # Lista de dependencias  

---

## ğŸ“ Archivos principales del proyecto

### `codigo.py`
Prepara los datos para modelar. Incluye:

- Limpieza y eliminaciÃ³n de columnas con muchos valores nulos.
- ConversiÃ³n de variables categÃ³ricas como sexo, diagnÃ³sticos y procedimientos a valores numÃ©ricos.
- Mapeo de los GRDs desde el cÃ³digo al identificador numÃ©rico usando la tabla maestra.
- Balanceo del dataset usando **RandomOverSampler**.
- Exporta un DataFrame llamado `nuevo_dataset`, junto con variables Ãºtiles como `y`, `num_cols`, etc.

---

### `graficos.py`
Genera grÃ¡ficos exploratorios que permiten visualizar:

- DistribuciÃ³n de GRDs antes y despuÃ©s del balanceo.
- Correlaciones entre variables numÃ©ricas.
- DistribuciÃ³n por sexo.
- Histogramas y boxplots de variables clÃ­nicas relevantes.
- Remapeo visual de GRDs frecuentes con mÃ¡s de 100 casos.

ğŸ“‚ Todos los grÃ¡ficos se almacenan en la carpeta `/Graficos`.

---

### `modelos_prueba.py`
Este script entrena y compara distintos modelos:

- ğŸŒ² Random Forest  
- ğŸŒ³ Ãrbol de DecisiÃ³n  
- ğŸš€ XGBoost  
- ğŸ§  Red Neuronal (MLPClassifier)  

Para cada modelo:

- Se muestran mÃ©tricas: Accuracy, PrecisiÃ³n, Recall, F1 Score, MAE, MSE.
- Se genera una **matriz de confusiÃ³n** visual en `/imagenes`.
- El modelo se guarda en `/modelos`.

---

### `entrenar_xgboost.py`
Entrena de forma especializada el modelo **XGBoost**, utilizando:

- Etiquetas codificadas con `LabelEncoder`
- Datos ya preprocesados con `codigo.py`

ğŸ” Guarda el modelo y el codificador en:  
ğŸ“ `modelos/xgboost_entrenado.pkl`

---

### `prueba_xgboost.py`
EvalÃºa el modelo entrenado de XGBoost con el conjunto de test:

- Genera predicciones
- Imprime mÃ©tricas detalladas de rendimiento
- Opcionalmente, guarda las predicciones en un `.csv` para anÃ¡lisis posterior

---

### `xgboost_decode.py`
Este script realiza una **comparaciÃ³n de predicciones individuales**:

- Muestra GRD real, GRD predicho y sus respectivas descripciones
- Indica si la predicciÃ³n fue correcta âœ… o incorrecta âŒ
- Mapea correctamente los ID con la tabla maestra
- Guarda los resultados en `/resultados/comparacion_grd.xlsx`

---

## âš™ï¸ CÃ³mo ejecutar el proyecto

### 1. Requisitos

AsegÃºrate de tener Python 3.10 o superior instalado.  
Instala las dependencias usando:

```bash
pip install -r requirements.txt


 ## 2. Flujo de ejecuciÃ³n recomendado
python codigo.py               # Prepara el nuevo_dataset
python graficos.py             # Genera los grÃ¡ficos
python modelos_prueba.py       # Entrena todos los modelos y guarda .pkl
python entrenar_xgboost.py     # Entrena y guarda modelo XGBoost
python prueba_xgboost.py       # EvalÃºa rendimiento de XGBoost
python xgboost_decode.py       # Compara predicciones individuales (GRD)
